version: "3.2"

services:
  cassandra-master:
    image: cassandra:3.11
    environment:
      CASSANDRA_BROADCAST_ADDRESS: "cassandra-master"
    deploy:
      restart_policy:
        condition: on-failure
        max_attempts: 3
        window: 120s
      placement:
        constraints:
          - "node.role==manager"
    volumes:
      - /opt/cassandra/data:/var/lib/cassandra
    networks:
      cassandra:

  cassandra-nodes:
    image: cassandra:3.11
    environment:
      CASSANDRA_SEEDS: "cassandra-master"
    deploy:
      replicas: 2
      placement:
        max_replicas_per_node: 1
      restart_policy:
        condition: on-failure
        max_attempts: 3
        window: 120s
      placement:
        constraints:
          - "node.role==worker"
    volumes:
      - /opt/cassandra/data:/var/lib/cassandra 
    networks:
      cassandra:

networks:
  cassandra: